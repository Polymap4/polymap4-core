<?xml version="1.0"?>
<!--
 This Ant build script downloads dependency jars needed by thus bundle
 from several maven repositories on the net. See copy.properties for
 general settings. 
 -->
<project name="org.eclipse.rap.selenium" default="build" basedir="." xmlns:artifact="antlib:org.apache.maven.artifact.ant">
	<description>Download open source jars from the internet.</description>

	<property name="lib" value="${basedir}${file.separator}lib" />
	<property name="libs_src_dir" value="${lib}${file.separator}sources" />
	<property environment="env" />
	<property name="selenium.version" value="2.47.1" />
	<dirname file="${ant.file.refresh_libs}" property="refresh_libs_basedir" />
    <available property="already_downloaded" type="dir" file="${lib}" />

    <!--
      Bootstrap: maven jars, ant task
      -->
    <property name="maven_download_dir" value="${user.home}/.m2/repository/org/apache/maven/maven-ant-tasks/2.0.10/" />
    <available property="bootstrapped" type="dir" file="${maven_download_dir}" />

    <target name="bootstrap" unless="bootstrapped">
        <mkdir dir="${maven_download_dir}" />
        <get src="http://central.maven.org/maven2/org/apache/maven/maven-ant-tasks/2.0.10/maven-ant-tasks-2.0.10.jar" 
             dest="${maven_download_dir}" />
    </target>
    
    <target name="init" depends="bootstrap">
        <taskdef uri="antlib:org.apache.maven.artifact.ant" resource="org/apache/maven/artifact/ant/antlib.xml">
            <classpath>
                <fileset dir="${maven_download_dir}">
                    <include name="*.jar" />
                </fileset>
            </classpath>
        </taskdef>
    </target>
    
	<target name="clean" description="deletes external libraries folder">
		<delete dir="${lib}" />
	</target>

	<target name="load_m2_deps" depends="init" unless="already_downloaded">
	    <!-- remote repositories -->
	    <artifact:remoteRepository id="central.repository" url="http://repo1.maven.org/maven2" />
	    <artifact:localRepository id="local.repository" path="${user.home}/.m2/repository" />

		<artifact:dependencies filesetId="dependency.fileset" sourcesFilesetId="sources.dependency.fileset" versionsId="dependency.versions" useScope="runtime">
			<localRepository refid="local.repository" />
			<remoteRepository refid="central.repository" />

			<dependency groupId="org/seleniumhq/selenium" artifactId="selenium-java" version="${selenium.version}" />
			<dependency groupId="org/seleniumhq/selenium" artifactId="selenium-remote-driver" version="${selenium.version}" />
			<dependency groupId="cglib" artifactId="cglib-nodep" version="2.1_3" />
			<dependency groupId="org/json" artifactId="json" version="20080701" />
			<dependency groupId="org/seleniumhq/selenium" artifactId="selenium-api" version="${selenium.version}" />
			<dependency groupId="com/google/guava" artifactId="guava" version="13.0.1" />
			<dependency groupId="org/apache/httpcomponents" artifactId="httpclient" version="4.5" />
			<dependency groupId="org/apache/httpcomponents" artifactId="httpcore" version="4.4.3" />
			<dependency groupId="commons-logging" artifactId="commons-logging" version="1.1.1" />
			<dependency groupId="commons-codec" artifactId="commons-codec" version="1.7" />
			<dependency groupId="org/apache/commons" artifactId="commons-exec" version="1.1" />
			<dependency groupId="net/java/dev/jna" artifactId="jna" version="3.4.0" />
			<dependency groupId="net/java/dev/jna" artifactId="platform" version="3.4.0" />
			<dependency groupId="org/seleniumhq/selenium" artifactId="selenium-chrome-driver" version="${selenium.version}" />
			<dependency groupId="org/seleniumhq/selenium" artifactId="selenium-htmlunit-driver" version="${selenium.version}" />
			<dependency groupId="net/sourceforge/htmlunit" artifactId="htmlunit" version="2.12" />
			<dependency groupId="xalan" artifactId="xalan" version="2.7.1" />
			<dependency groupId="xalan" artifactId="serializer" version="2.7.1" />
			<dependency groupId="xml-apis" artifactId="xml-apis" version="1.4.01"/>
			<dependency groupId="commons-collections" artifactId="commons-collections" version="3.2.1" />
			<dependency groupId="org/apache/commons" artifactId="commons-lang3" version="3.1" />
			<dependency groupId="org/apache/httpcomponents" artifactId="httpmime" version="4.2.3" />
			<dependency groupId="net/sourceforge/htmlunit" artifactId="htmlunit-core-js" version="2.12" />
			<dependency groupId="xerces" artifactId="xercesImpl" version="2.10.0" />
			<dependency groupId="net/sourceforge/nekohtml" artifactId="nekohtml" version="1.9.18" />
			<dependency groupId="net/sourceforge/cssparser" artifactId="cssparser" version="0.9.9" />
			<dependency groupId="org/w3c/css" artifactId="sac" version="1.3" />
			<dependency groupId="commons-io" artifactId="commons-io" version="2.2" />
			<dependency groupId="org/eclipse/jetty" artifactId="jetty-websocket" version="8.1.9.v20130131" />
			<dependency groupId="org/eclipse/jetty" artifactId="jetty-util" version="8.1.9.v20130131" />
			<dependency groupId="org/eclipse/jetty" artifactId="jetty-io" version="8.1.9.v20130131" />
			<dependency groupId="org/eclipse/jetty" artifactId="jetty-http" version="8.1.9.v20130131" />
			<dependency groupId="org/seleniumhq/selenium" artifactId="selenium-firefox-driver" version="${selenium.version}" />
			<dependency groupId="org/seleniumhq/selenium" artifactId="selenium-ie-driver" version="${selenium.version}" />
			<dependency groupId="org/seleniumhq/selenium" artifactId="selenium-safari-driver" version="${selenium.version}" />
			<dependency groupId="org/webbitserver" artifactId="webbit" version="0.4.14" />
			<dependency groupId="io/netty" artifactId="netty" version="3.5.2.Final" />
			<dependency groupId="org/seleniumhq/selenium" artifactId="selenium-support" version="${selenium.version}" />
			<dependency groupId="com/google/protobuf" artifactId="protobuf-java" version="2.4.1" />
			<dependency groupId="commons-jxpath" artifactId="commons-jxpath" version="1.3" />
			<dependency groupId="org/ini4j" artifactId="ini4j" version="0.5.2" />
			<dependency groupId="junit" artifactId="junit" version="4.8.2" />			
		</artifact:dependencies>
	</target>

	<target name="build" depends="create, load_m2_deps" unless="already_downloaded">
		<description>Download the jars - used by a manual "clean"</description>

		<!-- (flat) copy all downloaded JARs (classes) to plugin directory ${lib} -->
		<copy todir="${lib}" verbose="true" flatten="true">
			<fileset refid="dependency.fileset" />
		</copy>

		<!-- (flat) copy downloaded source JARs (sources) to plugin directory ${libs_src_dir} -->
		<copy todir="${libs_src_dir}" flatten="true" verbose="true">
			<fileset refid="sources.dependency.fileset" />
			<chainedmapper>
				<mapper type="flatten" />
				<globmapper from="*-sources.jar" to="*-sources.zip" />
			</chainedmapper>
		</copy>
		<!-- <eclipse.refreshLocal resource="net.refractions.udig.libs/lib" depth="infinite"/>	-->
	</target>

	<target name="create" unless="already_downloaded">
		<description>creates the lib directory if needed</description>
		<mkdir dir="${lib}" />
		<mkdir dir="${libs_src_dir}" />
	</target>

	<!-- Used by headless build please make sure this does everthing from clean to download and fix etc.. -->
	<target name="full-build" depends="clean, build" description="clean and build">
	</target>
</project>
